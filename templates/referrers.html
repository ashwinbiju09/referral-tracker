{% extends "base.html" %}

{% block title %}Referrers{% endblock %}

{% block content %}
<h1 class="text-center fw-bold mb-4">Referrers</h1>

<!-- Search Bar -->
<div class="input-group mb-4">
    <input type="text" id="search-bar" class="form-control shadow-sm" placeholder="Search by name or contact">
</div>

<!-- Referrers List -->
<div class="row" id="referrers-list">
    {% for referrer in referrers %}
        <div class="col-md-6 mb-3 referrer-item">
            <div class="card">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <p class="mb-1"><strong>Name:</strong> {{ referrer.name }}</p>
                        <p class="mb-1"><strong>Contact:</strong> {{ referrer.contact }}</p>
                        <p class="mb-0"><strong>Total References:</strong> {{ referrer.total_references or 0 }}</p>
                    </div>
                    <div class="text-end">
                        <p class="mb-1"><strong>Code:</strong> {{ referrer.referral_code }}</p>
                        <div class="d-flex gap-2">
                            <a href="/search_referral?referral_code={{ referrer.referral_code }}" class="btn btn-success btn-sm shadow-sm">Show Referees</a>
                            <form action="/delete_referrer/{{ referrer.id }}" method="POST">
                                <button type="submit" class="btn btn-danger btn-sm shadow-sm" onclick="return confirm('Are you sure you want to delete this referrer?')">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
</div>

<!-- Pagination -->
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% if page > 1 %}
            <li class="page-item">
                <a class="page-link" href="/referrers?page={{ page - 1 }}">Previous</a>
            </li>
        {% endif %}
        {% for p in range(1, total_pages + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="/referrers?page={{ p }}">{{ p }}</a>
            </li>
        {% endfor %}
        {% if page < total_pages %}
            <li class="page-item">
                <a class="page-link" href="/referrers?page={{ page + 1 }}">Next</a>
            </li>
        {% endif %}
    </ul>
</nav>

<!-- Search Script -->
<script>
    document.getElementById('search-bar').addEventListener('input', function () {
        const query = this.value.toLowerCase();
        const referrers = document.querySelectorAll('.referrer-item');

        referrers.forEach(referrer => {
            const name = referrer.querySelector('p:nth-child(1)').textContent.toLowerCase();
            const contact = referrer.querySelector('p:nth-child(2)').textContent.toLowerCase();
            const code = referrer.querySelector('p:nth-child(3)').textContent.toLowerCase();

            if (name.includes(query) || contact.includes(query) || code.includes(query)) {
                referrer.style.display = '';
            } else {
                referrer.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}
